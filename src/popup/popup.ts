import * as THREE from 'three';

const progress = document.querySelector('#progress') as HTMLProgressElement;
const updateButton = document.querySelector('#updateButton') as HTMLButtonElement;

updateButton.onclick = () => {
  console.log('updateButton click')
  chrome.runtime.sendMessage({contentScriptQuery: "get-tag-data"})
};
chrome.runtime.onMessage.addListener((msg) => {
  console.log('msg', msg);
})


const objTxt = `ply
format ascii 1.0
comment : MagicaVoxel @ Ephtracy
element vertex 565
property float x
property float y
property float z
property uchar red
property uchar green
property uchar blue
end_header
-7 5 8 252 100 0
-6 5 2 252 100 0
-6 4 7 252 100 0
-6 4 6 252 100 0
-6 3 7 252 100 0
-6 3 6 252 100 0
-6 3 5 252 100 0
-6 2 6 252 100 0
-5 4 6 252 100 0
-5 4 5 252 100 0
-5 4 3 252 100 0
-5 4 2 252 100 0
-5 3 6 252 100 0
-5 3 5 252 100 0
-5 3 3 252 100 0
-5 3 2 252 100 0
-5 2 6 252 100 0
-5 2 5 252 100 0
-4 8 9 252 100 0
-4 7 3 252 100 0
-4 4 6 252 100 0
-4 4 5 252 100 0
-4 4 3 252 100 0
-4 4 2 252 100 0
-4 3 6 252 100 0
-4 3 5 252 100 0
-4 3 4 252 100 0
-4 3 3 252 152 0
-4 3 2 252 100 0
-4 2 11 252 152 0
-4 2 10 252 152 0
-4 2 9 252 152 0
-4 2 6 252 100 0
-4 2 5 252 100 0
-4 2 4 252 100 0
-4 2 3 252 100 0
-4 1 15 252 152 0
-4 1 14 252 152 0
-4 1 13 252 152 0
-4 1 11 100 152 252
-4 1 10 252 152 0
-4 1 8 252 152 0
-4 1 2 48 100 252
-4 0 16 252 152 0
-4 0 15 252 100 0
-4 0 14 252 100 0
-4 0 13 252 100 0
-4 0 12 100 152 252
-4 0 11 252 152 0
-4 0 10 100 152 252
-4 0 9 252 152 0
-4 0 7 252 152 0
-4 0 6 252 152 0
-4 0 4 252 204 152
-4 0 2 48 100 252
-4 -1 16 252 152 0
-4 -1 12 252 152 0
-4 -1 11 100 152 252
-4 -1 10 252 152 0
-4 -1 8 252 152 0
6 5 8 252 100 0
-4 -2 10 252 152 0
-4 -2 9 252 152 0
-3 7 8 252 100 0
-3 7 7 252 100 0
-3 7 6 252 100 0
-3 6 7 252 100 0
-3 6 6 252 100 0
-3 6 3 252 100 0
-3 6 2 252 100 0
-3 5 6 252 100 0
-3 5 2 252 100 0
-3 4 5 252 100 0
-3 4 4 252 100 0
-3 4 3 252 100 0
-3 4 2 252 100 0
-3 3 11 252 152 0
-3 3 10 252 152 0
-3 3 9 252 152 0
-3 3 5 252 100 0
-3 3 4 252 100 0
-3 3 3 252 100 0
-3 3 2 252 100 0
-3 2 12 252 152 0
-3 2 11 252 152 0
-3 2 10 252 152 0
-3 2 9 252 152 0
-3 2 8 252 152 0
-3 2 7 252 152 0
-3 2 5 252 100 0
-3 2 4 252 100 0
-3 2 3 100 152 252
-3 2 2 48 100 252
-3 1 15 252 152 0
-3 1 14 252 152 0
-3 1 13 252 152 0
-3 1 12 252 152 0
-3 1 11 252 152 0
-3 1 10 252 152 0
-3 1 9 252 152 0
-3 1 8 252 152 0
-3 1 7 252 152 0
-3 1 3 100 152 252
-3 1 2 48 100 252
-3 0 15 252 152 0
-3 0 14 252 100 0
-3 0 13 252 100 0
-3 0 12 252 152 0
-3 0 11 252 152 0
-3 0 10 252 152 0
-3 0 9 252 152 0
-3 0 8 252 152 100
-3 0 7 252 152 0
-3 0 5 252 252 252
-3 0 3 100 152 252
-3 0 2 48 100 252
-3 -1 15 252 152 0
-3 -1 12 252 152 0
-3 -1 11 252 152 0
-3 -1 10 252 152 0
-3 -1 9 252 152 0
-3 -1 8 136 136 136
-3 -1 3 100 152 252
5 2 6 252 100 0
-3 -2 11 252 152 0
-3 -2 10 252 152 0
-3 -2 9 252 152 0
-3 -2 8 252 152 0
-3 -2 7 252 152 0
5 3 5 252 100 0
-3 -3 9 252 152 0
-2 7 7 252 100 0
-2 7 6 252 100 0
-2 6 7 252 100 0
-2 6 6 252 100 0
-2 6 2 252 100 0
-2 5 6 252 100 0
-2 5 5 252 100 0
-2 5 2 252 100 0
-2 4 10 252 152 0
-2 4 9 252 152 0
-2 4 8 252 152 0
-2 4 5 252 100 0
-2 4 3 252 100 0
-2 4 2 252 100 0
-2 3 11 252 152 0
-2 3 10 252 152 0
-2 3 9 252 152 0
-2 3 8 252 152 0
-2 3 7 252 152 0
-2 3 5 252 100 0
-2 3 4 252 100 0
-2 3 3 100 152 252
-2 3 2 48 100 252
-2 2 12 252 152 0
-2 2 11 252 152 0
-2 2 10 252 152 0
-2 2 9 252 152 0
-2 2 8 252 152 0
-2 2 7 252 152 0
-2 2 6 252 152 0
-2 2 4 252 100 0
-2 2 3 100 152 252
-2 2 2 48 100 252
-2 1 14 252 152 0
-2 1 13 252 152 0
-2 1 12 252 152 0
-2 1 11 252 152 0
-2 1 10 252 152 0
-2 1 9 252 152 0
-2 1 8 252 152 0
-2 1 7 252 152 0
-2 1 6 252 152 0
-2 1 5 100 152 252
-2 1 4 100 152 252
-2 1 3 236 236 236
-2 1 2 48 100 252
-2 0 14 252 152 0
-2 0 13 252 152 0
-2 0 12 252 152 0
-2 0 11 252 152 0
-2 0 10 252 152 0
-2 0 9 252 152 0
-2 0 8 252 152 0
-2 0 7 252 152 0
-2 0 6 252 204 252
-2 0 5 252 204 252
-2 0 4 100 152 252
-2 0 3 252 204 152
-2 0 2 48 100 252
-2 0 1 252 152 100
-2 0 0 152 152 204
-2 -1 14 252 152 0
-2 -1 13 252 152 0
-2 -1 12 252 152 0
-2 -1 11 252 152 0
-2 -1 10 252 152 0
-2 -1 9 252 152 0
-2 -1 8 16 16 16
-2 -1 7 252 152 100
-2 -1 6 252 152 0
-2 -1 5 100 152 252
-3 -1 2 48 100 252
-4 -1 2 48 100 252
-3 -2 2 48 100 252
-2 -2 12 252 152 0
-2 -2 11 252 152 0
-2 -2 10 252 152 0
-2 -2 6 252 152 0
5 3 6 252 100 0
5 3 7 252 100 0
-2 -3 10 252 152 0
-2 -3 2 48 100 252
-1 5 5 252 100 0
-1 4 10 252 152 0
-1 4 9 252 152 0
-1 4 6 252 100 0
-1 4 5 252 100 0
-1 4 4 252 100 0
-1 4 2 252 100 0
-1 3 11 252 152 0
-1 3 10 252 152 0
-1 3 9 252 152 0
-1 3 8 252 152 0
-1 3 7 252 152 0
-1 3 6 252 100 0
-1 3 5 252 100 0
-1 3 4 252 100 0
-1 3 3 252 100 0
-1 3 2 48 100 252
-1 2 12 252 152 0
-1 2 11 252 152 0
-1 2 10 252 152 0
-1 2 9 252 152 0
-1 2 8 252 152 0
-1 2 7 252 152 0
-1 2 6 252 152 0
-1 2 3 252 252 252
-1 2 2 48 100 252
-1 1 12 252 152 0
-1 1 11 252 152 0
-1 1 10 252 152 0
-1 1 9 252 152 0
-1 1 8 252 152 0
-1 1 7 252 152 0
-1 1 6 252 152 0
-1 1 5 252 252 252
-1 1 4 252 252 252
-1 1 3 252 252 252
-1 1 2 48 100 252
-1 0 12 252 152 0
-1 0 11 252 152 0
-1 0 10 252 152 0
-1 0 9 252 152 0
-1 0 8 252 152 0
-1 0 7 252 152 0
-1 0 6 252 152 0
-1 0 5 252 152 0
-1 0 4 252 204 252
-1 0 3 252 204 252
-1 0 2 48 100 252
-1 -1 12 252 152 0
-1 -1 11 252 152 0
-1 -1 10 252 152 0
-1 -1 9 252 152 0
-1 -1 8 252 204 152
-1 -1 7 252 152 100
-1 -1 6 100 152 252
-1 -1 5 252 252 252
5 4 6 252 100 0
5 4 7 252 100 0
5 5 2 252 100 0
-1 -2 12 252 152 0
-1 -2 11 252 152 0
-1 -2 10 252 152 0
-1 -2 9 252 152 0
4 2 5 252 100 0
4 2 6 252 100 0
-1 -3 11 252 152 0
-1 -3 10 252 152 0
-1 -3 2 48 100 252
0 5 5 252 100 0
0 4 10 252 152 0
0 4 9 252 152 0
0 4 6 252 100 0
0 4 5 252 100 0
0 4 4 252 100 0
0 4 2 252 100 0
0 3 11 252 152 0
0 3 10 252 152 0
0 3 9 252 152 0
0 3 8 252 152 0
0 3 7 252 152 0
0 3 6 252 100 0
0 3 5 252 100 0
0 3 4 252 100 0
0 3 3 252 100 0
0 3 2 48 100 252
0 2 12 252 152 0
0 2 11 252 152 0
0 2 10 252 152 0
0 2 9 252 152 0
0 2 8 252 152 0
0 2 7 252 152 0
0 2 6 252 152 0
0 2 3 252 252 252
0 2 2 48 100 252
0 1 12 252 152 0
0 1 11 252 152 0
0 1 10 252 152 0
0 1 9 252 152 0
0 1 8 252 152 0
0 1 7 252 152 0
0 1 6 252 152 0
0 1 5 252 252 252
0 1 4 252 252 252
0 1 3 252 252 252
0 1 2 48 100 252
0 0 12 252 152 0
0 0 11 252 152 0
0 0 10 252 152 0
0 0 9 252 152 0
0 0 8 252 152 0
0 0 7 252 152 0
0 0 6 252 152 0
0 0 5 252 152 0
0 0 4 252 204 252
0 0 3 252 204 252
0 0 2 48 100 252
0 -1 12 252 152 0
0 -1 11 252 152 0
0 -1 10 252 152 0
0 -1 9 252 152 0
0 -1 8 252 204 152
0 -1 7 252 204 152
0 -1 6 100 152 252
0 -1 5 252 252 252
0 -1 4 252 252 252
0 -1 3 252 252 252
0 -1 2 48 100 252
0 -2 12 252 152 0
0 -2 11 252 152 0
0 -2 10 252 152 0
0 -2 9 252 152 0
0 -2 3 252 252 252
0 -2 2 48 100 252
0 -3 11 252 152 0
0 -3 10 252 152 0
0 -3 2 48 100 252
1 7 7 252 100 0
1 7 6 252 100 0
1 6 7 252 100 0
1 6 6 252 100 0
1 6 2 252 100 0
1 5 6 252 100 0
1 5 5 252 100 0
1 5 2 252 100 0
1 4 10 252 152 0
1 4 9 252 152 0
1 4 8 252 152 0
1 4 5 252 100 0
1 4 3 252 100 0
1 4 2 252 100 0
1 3 11 252 152 0
1 3 10 252 152 0
1 3 9 252 152 0
1 3 8 252 152 0
1 3 7 252 152 0
1 3 5 252 100 0
1 3 4 252 100 0
1 3 3 100 152 252
1 3 2 48 100 252
1 2 12 252 152 0
1 2 11 252 152 0
1 2 10 252 152 0
1 2 9 252 152 0
1 2 8 252 152 0
1 2 7 252 152 0
1 2 6 252 152 0
1 2 4 252 100 0
1 2 3 100 152 252
1 2 2 48 100 252
1 1 14 252 152 0
1 1 13 252 152 0
1 1 12 252 152 0
1 1 11 252 152 0
1 1 10 252 152 0
1 1 9 252 152 0
1 1 8 252 152 0
1 1 7 252 152 0
1 1 6 252 152 0
1 1 5 100 152 252
1 1 4 100 152 252
1 1 3 236 236 236
1 1 2 48 100 252
1 0 14 252 152 0
1 0 13 252 152 0
1 0 12 252 152 0
1 0 11 252 152 0
1 0 10 252 152 0
1 0 9 252 152 0
1 0 8 252 152 0
1 0 7 252 152 0
1 0 6 252 152 0
1 0 5 48 152 100
1 0 4 100 152 252
1 0 3 252 204 152
1 0 2 48 100 252
1 0 1 252 152 100
1 0 0 152 152 204
1 -1 14 252 152 0
1 -1 13 252 152 0
1 -1 12 252 152 0
1 -1 11 252 152 0
1 -1 10 252 152 0
1 -1 9 252 152 0
1 -1 8 16 16 16
1 -1 7 252 204 152
1 -1 6 252 152 0
1 -1 5 100 152 252
1 -1 4 100 152 252
1 -1 3 100 152 252
1 -1 2 48 100 252
1 -2 12 252 152 0
1 -2 11 252 152 0
1 -2 10 252 152 0
1 -2 6 252 152 0
1 -2 3 100 152 252
1 -2 2 48 100 252
1 -3 11 252 152 0
1 -3 2 48 100 252
2 7 8 252 100 0
2 7 7 252 100 0
2 7 6 252 100 0
2 6 7 252 100 0
2 6 6 252 100 0
2 6 3 252 100 0
2 6 2 252 100 0
2 5 6 252 100 0
2 5 2 252 100 0
2 4 5 252 100 0
2 4 4 252 100 0
2 4 3 252 100 0
2 4 2 252 100 0
2 3 11 252 152 0
2 3 10 252 152 0
2 3 9 252 152 0
2 3 5 252 100 0
2 3 4 252 100 0
2 3 3 252 100 0
2 3 2 252 100 0
2 2 12 252 152 0
2 2 11 252 152 0
2 2 10 252 152 0
2 2 9 252 152 0
2 2 8 252 152 0
2 2 7 252 152 0
2 2 6 252 152 0
2 2 5 252 100 0
2 2 4 252 100 0
2 2 3 100 152 252
2 2 2 48 100 252
2 1 15 252 152 0
2 1 14 252 152 0
2 1 13 252 152 0
2 1 12 252 152 0
2 1 11 252 152 0
2 1 10 252 152 0
2 1 9 252 152 0
2 1 8 252 152 0
2 1 7 252 152 0
2 1 3 100 152 252
2 1 2 48 100 252
2 0 15 252 152 0
2 0 14 252 100 0
2 0 13 252 100 0
2 0 12 252 152 0
2 0 11 252 152 0
2 0 10 252 152 0
2 0 9 252 152 0
2 0 8 252 152 100
2 0 7 136 136 136
2 0 5 252 252 252
2 0 3 100 152 252
2 0 2 48 100 252
2 -1 15 252 152 0
2 -1 12 252 152 0
2 -1 11 252 152 0
2 -1 10 252 152 0
2 -1 9 252 152 0
2 -1 8 252 152 0
2 -1 3 100 152 252
2 -1 2 48 100 252
2 -2 11 252 152 0
2 -2 10 252 152 0
2 -2 9 252 152 0
2 -2 8 252 152 0
2 -2 7 252 152 0
2 -2 2 48 100 252
2 -3 10 252 152 0
3 8 9 252 100 0
3 7 3 252 100 0
3 4 6 252 100 0
3 4 5 252 100 0
3 4 3 252 100 0
3 4 2 252 100 0
3 3 6 252 100 0
3 3 5 252 100 0
3 3 4 252 100 0
3 3 3 252 152 0
3 3 2 252 100 0
3 2 11 252 152 0
3 2 10 252 152 0
3 2 9 252 152 0
3 2 6 252 100 0
3 2 5 252 100 0
3 2 4 252 100 0
3 2 3 252 100 0
3 1 15 252 152 0
3 1 14 252 152 0
3 1 13 252 152 0
3 1 12 252 152 0
3 1 11 100 152 252
3 1 10 252 152 0
3 1 8 252 152 0
3 1 2 48 100 252
3 0 16 252 152 0
3 0 15 252 100 0
3 0 14 252 100 0
3 0 13 252 100 0
3 0 12 100 152 252
3 0 11 252 152 0
3 0 10 100 152 252
3 0 9 252 152 0
3 0 7 252 152 0
3 0 6 252 152 0
3 0 4 252 204 152
3 0 2 48 100 252
3 -1 16 252 152 0
3 -1 12 252 152 0
3 -1 11 100 152 252
3 -1 10 252 152 0
3 -1 8 252 152 0
3 -1 2 48 100 252
3 -2 10 252 152 0
3 -2 9 252 152 0
3 -3 9 252 152 0
4 4 6 252 100 0
4 4 5 252 100 0
4 4 3 252 100 0
4 4 2 252 100 0
4 3 6 252 100 0
4 3 5 252 100 0
4 3 3 252 100 0
4 3 2 252 100 0
-2 -2 2 48 100 252
-1 -2 2 48 100 252
-2 -1 2 48 100 252
-1 -1 2 48 100 252
-2 -2 3 100 152 252
-1 -2 3 252 252 252
-2 -1 3 100 152 252
-1 -1 3 252 252 252
-2 -1 4 100 152 252
-1 -1 4 252 252 252
`

const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);

const renderer = new THREE.WebGLRenderer({ precision: 'highp', antialias: true,alpha:true });
renderer.setPixelRatio(window.devicePixelRatio)
renderer.setSize( 200, 200 );

document.body.insertBefore(renderer.domElement,document.body.firstChild);

const geometry = new THREE.BoxGeometry( 1, 1, 1 );




const boxGeometry = new THREE.BoxGeometry( 0, 0, 0 );
const box = new THREE.Mesh( geometry , new THREE.MeshBasicMaterial({color: 0xff0000 }));

// box.position.x = -10;
// box.position.y = -10;

scene.add( box );
let maxX = 0;
let maxY = 0;
let maxZ = 0;

objTxt.split('\n').forEach(v => {
  const d = v.split(' ');
  if(!(d.length == 6 && !isNaN(Number(d[0])))){
    return;
  }

  const z = Number(d[0]);
  const x = Number(d[1]);
  const y = Number(d[2]);

  maxX = Math.max(maxX, Math.abs(x));
  maxY = Math.max(maxY, Math.abs(y));
  maxZ = Math.max(maxZ, Math.abs(z));

  const r = parseInt(d[3], 10);
  const g = parseInt(d[4], 10);
  const b = parseInt(d[5], 10);

  const material = new THREE.MeshLambertMaterial( { color: new THREE.Color(r/255, g/255, b/255), opacity: 1, transparent: false } );
  const cube = new THREE.Mesh( geometry, material );
  cube.position.x = x;
  cube.position.y = y;
  cube.position.z = z;
  cube.castShadow = true;
  cube.receiveShadow = true;

  box.add( cube );
});

scene.add(new THREE.AmbientLight(0xffffff, 0.6));

const light1 = new THREE.DirectionalLight(0xffffff, 0.4);
// const light2 = new THREE.SpotLight(0xffffff, 0.5);
light1.position.set(1, -10, 30);
// light2.position.set(20, 20, 80);
scene.add(light1);
// scene.add(light2);

box.rotation.y = 45;
// box.position.x =  -Math.round(maxX/2) + 4;
box.position.y =  -Math.round(maxY/2);
// box.position.z =  Math.round(maxZ/2) + 4;

camera.position.z = maxZ * 3;



const animate = function () {
  requestAnimationFrame( animate );
  box.rotation.y += 0.005;
  renderer.render( scene, camera );
};

animate();
